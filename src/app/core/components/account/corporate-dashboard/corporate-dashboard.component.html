<div class="container-fluid p-0 d-flex h-100">
 
      <app-dynamic-menus></app-dynamic-menus>
      
 

  <div class="bg-light flex-fill">
    <!-- Mobile Header -->
    <div class="p-2 d-md-none d-flex text-white bg-blue">
      <a href="#" class="text-white" (click)="toggleSidebar()">
        <i class="fa-solid fa-bars"></i>
      </a>
      <span class="ms-3">Data Kavach</span>
    </div>

    <div class="p-4">
      <!-- Top Navbar -->
      <nav class="navbar navbar-expand-lg bg-blue shadow-sm rounded">
        <div class="container-fluid d-flex justify-content-between align-items-center">
          <a class="navbar-brand text-white" href="dashboard">
            Welcome: {{ userSessionDetails?.username }}
          </a>
          <div class="d-flex align-items-center">
            <div class="stat-card me-3">
              <h6 class="mb-1 fw-semibold">Total User</h6>
              <h4 class="mb-0 fw-bold">{{ userCount }}</h4>
              <i class="fa fa-users fa-lg opacity-75 ms-2"></i>
            </div>
            <div class="stat-card">
              <h6 class="fw-bold mb-2">Storage Used</h6>
              <div *ngIf="!storageCalculationFailed; else storageError">
                <div class="progress mb-2">
                  <div
                    class="progress-bar bg-info"
                    role="progressbar"
                    [style.width]="getStoragePercentage() + '%'"
                    [attr.aria-valuenow]="getStoragePercentage()"
                    aria-valuemin="0"
                    aria-valuemax="100"
                  ></div>
                </div>
                <p class="mb-0 small">
                  {{ formatSize(totalStorageUsed) }} / {{ formatSize(totalStorageLimit) }}
                  <span class="ms-2">Remaining: {{ formatSize(totalStorageLimit - totalStorageUsed) }}</span>
                </p>
              </div>
              <ng-template #storageError>
                <p class="fw-bold text-danger small">Error calculating storage</p>
              </ng-template>
            </div>
          </div>
        </div>
      </nav>

      <div class="row mt-4">
        <!-- Left Section (Search Bar and Charts) -->
        <div class="col-md-8">
          <!-- Search Bar -->
          <div class="search-bar mb-4">
            <input type="text" class="form-control" placeholder="File Name" [(ngModel)]="searchFileName" />
            <button class="btn btn-blue ms-2" (click)="searchFiles()">Enter File Name</button>
          </div>

          <!-- Charts Section -->
          <div class="row g-4 mb-4">
            <!-- Bar Chart -->
            <div class="col-md-6">
              <div class="card shadow-sm p-3 bg-white rounded">
                <canvas #barChartCanvas width="300" height="200"></canvas>
              </div>
            </div>
            <!-- Pie Chart -->
            <div class="col-md-6">
              <div class="card shadow-sm p-3 bg-white rounded">
                <canvas #storagePieChart width="200" height="200"></canvas>
              </div>
            </div>
          </div>
        </div>

        <!-- Right Section (File Explorer) -->
        <div class="col-md-4">
          <!-- Folder Explorer Section -->
          <h2 class="mb-4 fw-bold text-blue">File Explorer</h2>

          <div *ngIf="errorMessage" class="alert alert-danger" role="alert">
            {{ errorMessage }}
          </div>

          <!-- Breadcrumbs -->
          <nav aria-label="breadcrumb" class="mb-3">
            <ol class="breadcrumb">
              <li class="breadcrumb-item">
                <a href="javascript:void(0)" (click)="listRootFolders()">Root</a>
              </li>
              <li *ngFor="let pathSegment of currentPath.split('/'); let i = index" class="breadcrumb-item">
                <a href="javascript:void(0)" (click)="navigateToPathSegment(i)">
                  {{ pathSegment }}
                </a>
              </li>
            </ol>
          </nav>

          <div class="d-flex justify-content-between align-items-center mb-3">
            <button *ngIf="pathHistory.length > 0" class="btn btn-blue btn-sm" (click)="navigateBack()">Back</button>
            <div class="filter-section">
              <button class="btn btn-outline-blue btn-sm" (click)="toggleFilter()">
                Filter <i class="fa fa-filter ms-1"></i>
              </button>
              <div class="filter-options mt-2" *ngIf="showFilter">
                <button class="btn btn-outline-blue btn-sm me-2" (click)="filterByLastUploaded()">Last Uploaded</button>
                <button class="btn btn-outline-blue btn-sm" (click)="filterBySizeWise()">Size Wise</button>
              </div>
            </div>
          </div>

          <!-- Loader -->
          <div class="text-center mt-4" *ngIf="loading">
            <div class="spinner-border text-blue" role="status">
              <span class="visually-hidden">Loading...</span>
            </div>
          </div>

          <!-- OneDrive Table -->
          <div class="card shadow-sm p-3 mb-4 bg-white rounded explorer-container" *ngIf="!loading && paginatedContents.length > 0">
            <table class="table table-hover">
              <thead>
                <tr>
                  <th scope="col">Name</th>
                  <th scope="col">Type</th>
                  <th scope="col">Size</th>
                </tr>
              </thead>
              <tbody>
                <tr *ngFor="let item of paginatedContents">
                  <td>
                    <a
                      *ngIf="item.type === 'folder'"
                      href="javascript:void(0)"
                      (click)="listFolderContents(item.name)"
                      class="text-blue"
                    >
                      <i [ngClass]="getFileIconClass(item)" class="fa-fw me-1"></i>
                      {{ item.name }}
                    </a>
                    <span *ngIf="item.type === 'file'">
                      <i [ngClass]="getFileIconClass(item)" class="fa-fw me-1"></i>{{ item.name }}
                    </span>
                  </td>
                  <td>{{ item.type | titlecase }}</td>
                  <td>{{ formatSize(item.size) }}</td>
                </tr>
              </tbody>
            </table>

            <!-- Pagination Controls -->
            
          </div>
          <nav aria-label="Page navigation">
            <ul class="pagination pagination-sm justify-content-center">
              <li class="page-item" [class.disabled]="currentPage === 0">
                <a class="page-link" href="javascript:void(0)" (click)="previousPage()">Previous</a>
              </li>
              <li class="page-item" *ngFor="let page of pageNumbers" [class.active]="currentPage === page - 1">
                <a class="page-link" href="javascript:void(0)" (click)="goToPage(page - 1)">{{ page }}</a>
              </li>
              <li class="page-item" [class.disabled]="currentPage === totalPages - 1 || totalPages === 0">
                <a class="page-link" href="javascript:void(0)" (click)="nextPage()">Next</a>
              </li>
            </ul>
          </nav>

          <!-- No Items State -->
          <div
            class="card shadow-sm p-3 mb-4 bg-white rounded explorer-container"
            *ngIf="!loading && paginatedContents.length === 0 && !errorMessage"
          >
            <div class="alert alert-info text-center" *ngIf="userSessionDetails">
              No items found in the OneDrive account for "{{ userSessionDetails?.username }}" in the current folder.
            </div>
            <div class="alert alert-warning text-center" *ngIf="!userSessionDetails">
              Please log in to view OneDrive folders.
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>
</div>